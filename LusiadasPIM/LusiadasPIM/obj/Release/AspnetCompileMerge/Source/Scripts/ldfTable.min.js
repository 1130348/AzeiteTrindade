function LDFTableSort(e,a){var t=$(e),r=t.attr("data-sortable");if("True"==r){var l=t.attr("data-field"),d="1";void 0!=t.attr("data-order")&&(d=t.attr("data-order"));var n=[];n[0]=l,n[1]=d,$.ajax({url:ldfTableOrderCallbackArray[a],dataType:"json",data:{orderValues:n},type:"POST",traditional:!0}).done(function(e){var r=-1*parseInt(d);t.attr("data-order",r),t.siblings().removeClass("sortAsc"),t.siblings().removeClass("sortDesc"),t.siblings().removeClass("active"),t.removeClass("sortAsc"),t.removeClass("sortDesc"),t.addClass(1==r?"sortAsc":"sortDesc"),t.addClass("active"),ldfTableCurPageAttribute[a]="1",LDFTableRenderBody(e,a)})}}function LDFTableRenderBody(e,a){var t=e.pageCount,r=e.rowCount;e=e.list_rows,ldfTableTBodyArray[a].empty(),ldfTableRowsArray[a]=e,0==$(e).length&&(row="<tr><td colspan='"+$(ldfTableHeaderArray[a]).length+"' style='text-align:center;'>Sem registos</td></tr>",ldfTableTBodyArray[a].append(row)),$.each(e,function(e,t){var r="<tr data-rowid='"+t.rowID+"'>";$.each(t.rowItems,function(e,t){$.each(ldfTableHeaderArray[a],function(e,a){if(t.itemColumnName==a.headerID&&0!=a.headerVisible){var l=t.itemValue;null==l&&(l=""),null!=t.itemLink&&""!==t.itemLink&&(l='<a href="'+t.itemLink+'">'+l+"</a>");var d="False";d=0==a.headerMobile?"False":"True";var n="";for(var i in a.headerStyle)a.headerStyle.hasOwnProperty(i)&&(n+=i+":"+a.headerStyle[i]+";");r+="<td data-showMobile='"+d+"' data-column='"+t.itemColumnName+"' data-editable='"+a.headerEditable+"' style='"+n+"'>"+l+"</td>"}})}),1==ldfTableAttributes[a].canEditRow&&(r+="<td><input type='button' class='ldfTableEditRow_"+a+"' value='Editar'/></td>"),1==ldfTableAttributes[a].canDeleteRow&&(r+="<td><input type='button' class='ldfTableRemoveRow_"+a+"' value='Remover'/></td>"),r+="</tr>",ldfTableTBodyArray[a].append(r)}),InitRowInlineButtons(a),LDFTableRenderPages(t,r,a)}function LDFTableRenderPages(e,a,t){var r=0,l="",d=0;for(ldfTableDivFooterArray[t].empty(),r=0;e>=r;r++)l=r+1==ldfTableCurPageAttribute[t]?"active":"",hidePage="",r+1>5&&(e>=r&&(hidePage="hidden",d+=1),r+1<=ldfTableCurPageAttribute[t]&&(""!=hidePage&&(d-=1),hidePage="")),itemPage="<li class='"+l+" "+hidePage+"'><a href='#' data-page='"+(r+1)+"' data-order='1'>"+(r+1)+"</a></li>",ldfTableDivFooterArray[t].append(itemPage);d>0&&(itemPage="<li><a href='#' data-page='0'>...</a></li>",ldfTableDivFooterArray[t].append(itemPage)),ldfTableDivFooterArray[t].parent().find(".row").remove(),itemPage="<div class='row' style='position: relative;width: 100%;margin-top: -10px;'><span class='rowCount'>Total: "+a+" Registos</span></div>",ldfTableDivFooterArray[t].parent().append(itemPage)}function LDFTableChangePage(e,a){var t=[];if(0==e){var r=$(ldfTableDivFooterArray[a])[0].id,l=0;$("#"+r+" li.hidden").each(function(){10>=l&&($(this).removeClass("hidden"),l++)}),0==$("#"+r+" li.hidden").length&&$("#"+r+" li").find("[data-page='0']").remove()}else{var d=ldfTableTHeaderArray[a].find("th.active");t[0]=d.attr("data-field"),t[1]=d.attr("data-order"),$.ajax({url:ldfTablePageCallbackArray[a],dataType:"json",data:{pageNumber:e,orderData:t},type:"POST",traditional:!0}).done(function(t){ldfTableCurPageAttribute[a]=e,LDFTableRenderBody(t,a)})}}function ToJavaScriptDate(e){var a,t,r,l;try{a=/Date\(([^)]+)\)/,t=a.exec(e),r=new Date(parseFloat(t[1])),l=r.getMonth()+1+"/"+r.getDate()+"/"+r.getFullYear()}catch(d){console.log("ldfTable | ToJavaScriptDate"+d.message),l=""}return l}function LDFTableResetCounter(e){clearInterval(ldfTableRefreshTimeObject[e])}function LDFTableRestartCounter(e){var a=ldfTableRefreshTime[e];ldfTableRefreshTimeObject[e]=setInterval(function(){UpdateRefreshHeader(e,a),window[ldfTableRefreshCallBackArray[e]]()},a)}function UpdateRefreshHeader(e,a){var t=new Date;t.setSeconds(t.getSeconds()+a/1e3);var r=(t.getHours()<=9?"0":"")+t.getHours(),l=(t.getMinutes()<=9?"0":"")+t.getMinutes(),d=(t.getSeconds()<=9?"0":"")+t.getSeconds();$("#autoRefresh"+e).children("span").html("Próxima atualização "+r+":"+l+":"+d)}function InitRowInlineButtons(e){$(".ldfTableEditRow_"+e).on("click",function(){var a=$(this),t=$(this).closest("tr");"true"==$(t).attr("data-editing")?SaveRow(e,a,t):EditRow(e,a,t)}),$(".ldfTableRemoveRow_"+e).on("click",function(){console.log("Remove Row In Development")})}function EditRow(e,a,t){$(t).attr("data-editing","true"),a.val("Gravar"),$(a).parent().append("<input type='button' class='ldfTableCancelEditRow_"+e+"' value='Cancelar'/>"),InitRowInlineCancelButton(e);t.attr("data-rowid");$.each(ldfTableHeaderArray[e],function(e,a){1==a.headerEditable&&$.each($(t).children("td"),function(e,t){$(t).attr("data-column")==a.headerID&&($(t).attr("data-curValue",$(t).html()),$(this).html(RenderEditorField(a,$(t).html())),$(".ldfeditable.minimal").iCheck({checkboxClass:"icheckbox_flat-green"}))})})}function SaveRow(e,a,t){var r=new Object;$.each($(t).children("td[data-editable='true']"),function(a,t){$.each(ldfTableHeaderArray[e],function(e,a){a.headerID==$(t).attr("data-column")&&(r[a.headerID]=GetEditorFieldValue(a,t))})}),$.ajax({url:ldfTableEditCallBackArray[e],dataType:"json",data:{rowID:t.attr("data-rowid"),fields:JSON.stringify(r)},type:"POST",traditional:!0}).done(function(l){t.attr("data-editing","false"),$(t).find("input.ldfTableCancelEditRow_"+e).remove(),$(a).val("Editar"),$.each($(t).children("td[data-editable='true']"),function(a,t){$.each(ldfTableHeaderArray[e],function(e,a){a.headerID==$(t).attr("data-column")&&$(t).html(r[a.headerID])})})})}function InitRowInlineCancelButton(e){$(".ldfTableCancelEditRow_"+e).on("click",function(){var a=$(this),t=$(this).closest("tr");$.each($(t).children("td[data-editable='true']"),function(e,a){$(a).html($(a).attr("data-curValue")),$(a).attr("data-curValue","")}),a.remove();var r=$(t).find("input.ldfTableEditRow_"+e);r.val("Editar"),t.attr("data-editing","false")})}function RenderEditorField(e,a){if(-1!=e.headerType.indexOf("String"))return"<input type='text' class='form-control' value='"+a+"' />";if(-1!=e.headerType.indexOf("DateTime"))return"<input type='text' class='form-control' value='"+a+"' />";if(-1!=e.headerType.indexOf("SelectList")||-1!=e.headerType.indexOf("Boolean")){var t="";for(var r in e.headerEditContent)if(e.headerEditContent.hasOwnProperty(r)){var l="";a==e.headerEditContent[r]&&(l="selected"),t+="<option valu='"+r+"' "+l+">"+e.headerEditContent[r]+"</option>"}return"<select class='form-control'>"+t+"</select>"}}function GetEditorFieldValue(e,a){return-1!=e.headerType.indexOf("String")?$(a).children().val():-1!=e.headerType.indexOf("DateTime")?$(a).children().val():-1!=e.headerType.indexOf("SelectList")?(console.log($($(a).children()).innerHTML),console.log($($(a).children()).selectedOptions),$(a).children().val()):-1!=e.headerType.indexOf("Boolean")?(console.log($($(a).children()).innerHTML),console.log($($(a).children()).selectedOptions),$(a).children().val()):void 0}if($(".internalFooter").on("click","li > a",function(e){e.preventDefault()}),"undefined"==typeof ldfTableRowsArray)var ldfTableRowsArray=new Array;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxkZlRhYmxlLmpzIl0sIm5hbWVzIjpbIkxERlRhYmxlU29ydCIsIm9iaiIsImF0dHJpZCIsImN1ck9iamVjdCIsIiQiLCJpc1NvcnRhYmxlIiwiYXR0ciIsImZpZWxkTmFtZSIsIm9yZGVyVmFsdWUiLCJ1bmRlZmluZWQiLCJvcmRlckRhdGEiLCJhamF4IiwidXJsIiwibGRmVGFibGVPcmRlckNhbGxiYWNrQXJyYXkiLCJkYXRhVHlwZSIsImRhdGEiLCJvcmRlclZhbHVlcyIsInR5cGUiLCJ0cmFkaXRpb25hbCIsImRvbmUiLCJyZXMiLCJ2YWx1ZSIsInBhcnNlSW50Iiwic2libGluZ3MiLCJyZW1vdmVDbGFzcyIsImFkZENsYXNzIiwibGRmVGFibGVDdXJQYWdlQXR0cmlidXRlIiwiTERGVGFibGVSZW5kZXJCb2R5IiwicGFnZUNvdW50Iiwicm93Q291bnQiLCJsaXN0X3Jvd3MiLCJsZGZUYWJsZVRCb2R5QXJyYXkiLCJlbXB0eSIsImxkZlRhYmxlUm93c0FycmF5IiwibGVuZ3RoIiwicm93IiwibGRmVGFibGVIZWFkZXJBcnJheSIsImFwcGVuZCIsImVhY2giLCJkYXRha2V5IiwiZGF0YVZhbHVlIiwicm93SUQiLCJyb3dJdGVtcyIsInJvd0tleSIsInJvd1ZhbHVlIiwiaGVhZGVyS2V5IiwiaGVhZGVyVmFsdWUiLCJpdGVtQ29sdW1uTmFtZSIsIml0ZW1WYWx1ZSIsIml0ZW1MaW5rIiwiYXR0ck1vYmlsZSIsInN0eWxlIiwiYyIsImhhc093blByb3BlcnR5IiwibGRmVGFibGVBdHRyaWJ1dGVzIiwiY2FuRWRpdFJvdyIsImNhbkRlbGV0ZVJvdyIsIkluaXRSb3dJbmxpbmVCdXR0b25zIiwiTERGVGFibGVSZW5kZXJQYWdlcyIsImkiLCJhY3RpdmVQYWdlIiwibkhpZGVQYWdlcyIsImxkZlRhYmxlRGl2Rm9vdGVyQXJyYXkiLCJoaWRlUGFnZSIsIml0ZW1QYWdlIiwicGFyZW50IiwiZmluZCIsInJlbW92ZSIsIkxERlRhYmxlQ2hhbmdlUGFnZSIsInBhZ2UiLCJvYmpJRCIsImlkIiwiaWR4IiwidGhpcyIsImVsZW0iLCJsZGZUYWJsZVRIZWFkZXJBcnJheSIsImxkZlRhYmxlUGFnZUNhbGxiYWNrQXJyYXkiLCJwYWdlTnVtYmVyIiwiVG9KYXZhU2NyaXB0RGF0ZSIsInBhdHRlcm4iLCJyZXN1bHRzIiwiZHQiLCJleGVjIiwiRGF0ZSIsInBhcnNlRmxvYXQiLCJnZXRNb250aCIsImdldERhdGUiLCJnZXRGdWxsWWVhciIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJtZXNzYWdlIiwiTERGVGFibGVSZXNldENvdW50ZXIiLCJjbGVhckludGVydmFsIiwibGRmVGFibGVSZWZyZXNoVGltZU9iamVjdCIsIkxERlRhYmxlUmVzdGFydENvdW50ZXIiLCJ0aW1lb3V0Q291bnQiLCJsZGZUYWJsZVJlZnJlc2hUaW1lIiwic2V0SW50ZXJ2YWwiLCJVcGRhdGVSZWZyZXNoSGVhZGVyIiwid2luZG93IiwibGRmVGFibGVSZWZyZXNoQ2FsbEJhY2tBcnJheSIsInRpbWUiLCJkdFRpbWUiLCJzZXRTZWNvbmRzIiwiZ2V0U2Vjb25kcyIsImhyIiwiZ2V0SG91cnMiLCJtbiIsImdldE1pbnV0ZXMiLCJzYyIsImNoaWxkcmVuIiwiaHRtbCIsIm9uIiwicGFyZW50VFIiLCJjbG9zZXN0IiwiU2F2ZVJvdyIsIkVkaXRSb3ciLCJ2YWwiLCJJbml0Um93SW5saW5lQ2FuY2VsQnV0dG9uIiwiaGVhZGVyRWRpdGFibGUiLCJ0ZGtleSIsInRkVmFsdWUiLCJoZWFkZXJJRCIsIlJlbmRlckVkaXRvckZpZWxkIiwiaUNoZWNrIiwiY2hlY2tib3hDbGFzcyIsImpzb25PYmplY3QiLCJPYmplY3QiLCJHZXRFZGl0b3JGaWVsZFZhbHVlIiwibGRmVGFibGVFZGl0Q2FsbEJhY2tBcnJheSIsImZpZWxkcyIsIkpTT04iLCJzdHJpbmdpZnkiLCJlZGl0T2JqIiwiY29sT2JqZWN0IiwiaGVhZGVyVHlwZSIsImluZGV4T2YiLCJpdGVtIiwiaGVhZGVyRWRpdENvbnRlbnQiLCJzZWxlY3RlZCIsImVkaXRPYmplY3QiLCJpbm5lckhUTUwiLCJzZWxlY3RlZE9wdGlvbnMiLCJlIiwicHJldmVudERlZmF1bHQiLCJBcnJheSJdLCJtYXBwaW5ncyI6IkFBQUEsUUFBU0EsY0FBYUMsRUFBS0MsR0FFdkIsR0FBSUMsR0FBWUMsRUFBRUgsR0FDZEksRUFBYUYsRUFBVUcsS0FBSyxnQkFFaEMsSUFBa0IsUUFBZEQsRUFDSixDQUNJLEdBQUlFLEdBQVlKLEVBQVVHLEtBQUssY0FDM0JFLEVBQWEsR0FFbUJDLFNBQWhDTixFQUFVRyxLQUFLLGdCQUNmRSxFQUFhTCxFQUFVRyxLQUFLLGNBR2hDLElBQUlJLEtBQ0pBLEdBQVUsR0FBS0gsRUFDZkcsRUFBVSxHQUFLRixFQUVmSixFQUFFTyxNQUNFQyxJQUFVQywyQkFBMkJYLEdBQ3JDWSxTQUFVLE9BQ1ZDLE1BQVlDLFlBQWVOLEdBQzNCTyxLQUFVLE9BQ1ZDLGFBQWEsSUFDZEMsS0FBSyxTQUFVQyxHQUVkLEdBQUlDLEdBQStCLEdBQXZCQyxTQUFTZCxFQUNyQkwsR0FBVUcsS0FBSyxhQUFjZSxHQUU3QmxCLEVBQVVvQixXQUFXQyxZQUFZLFdBQ2pDckIsRUFBVW9CLFdBQVdDLFlBQVksWUFDakNyQixFQUFVb0IsV0FBV0MsWUFBWSxVQUVqQ3JCLEVBQVVxQixZQUFZLFdBQ3RCckIsRUFBVXFCLFlBQVksWUFJbEJyQixFQUFVc0IsU0FGRCxHQUFUSixFQUVtQixVQUVBLFlBRXZCbEIsRUFBVXNCLFNBQVMsVUFFbkJDLHlCQUF5QnhCLEdBQVUsSUFDbkN5QixtQkFBbUJQLEVBQUtsQixNQWFwQyxRQUFTeUIsb0JBQW1CWixFQUFNYixHQUM5QixHQUFJMEIsR0FBZWIsRUFBS2EsVUFDcEJDLEVBQWVkLEVBQUtjLFFBQ3hCZCxHQUFtQkEsRUFBS2UsVUFFeEJDLG1CQUFtQjdCLEdBQVE4QixRQUMzQkMsa0JBQWtCL0IsR0FBVWEsRUFFTixHQUFsQlgsRUFBRVcsR0FBTW1CLFNBRVJDLElBQU0sb0JBQXNCL0IsRUFBRWdDLG9CQUFvQmxDLElBQVNnQyxPQUFTLHNEQUNw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SjdCLE9BMVdYLEdBTEFsSCxFQUFFLG1CQUFtQjZHLEdBQUcsUUFBUyxTQUFVLFNBQVUrQixHQUNqREEsRUFBRUMsbUJBSTJCLG1CQUF2QixtQkFBdUMsR0FBSWhILG1CQUFvQixHQUFJaUgiLCJmaWxlIjoibGRmVGFibGUubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gTERGVGFibGVTb3J0KG9iaiwgYXR0cmlkKVxyXG57XHJcbiAgICB2YXIgY3VyT2JqZWN0ID0gJChvYmopO1xyXG4gICAgdmFyIGlzU29ydGFibGUgPSBjdXJPYmplY3QuYXR0cihcImRhdGEtc29ydGFibGVcIik7XHJcblxyXG4gICAgaWYgKGlzU29ydGFibGUgPT0gXCJUcnVlXCIpIFxyXG4gICAge1xyXG4gICAgICAgIHZhciBmaWVsZE5hbWUgPSBjdXJPYmplY3QuYXR0cihcImRhdGEtZmllbGRcIik7XHJcbiAgICAgICAgdmFyIG9yZGVyVmFsdWUgPSBcIjFcIjtcclxuXHJcbiAgICAgICAgaWYgKGN1ck9iamVjdC5hdHRyKFwiZGF0YS1vcmRlclwiKSAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgb3JkZXJWYWx1ZSA9IGN1ck9iamVjdC5hdHRyKFwiZGF0YS1vcmRlclwiKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBvcmRlckRhdGEgPSBbXTtcclxuICAgICAgICBvcmRlckRhdGFbMF0gPSBmaWVsZE5hbWU7XHJcbiAgICAgICAgb3JkZXJEYXRhWzFdID0gb3JkZXJWYWx1ZTtcclxuXHJcbiAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgdXJsOiAgICAgIGxkZlRhYmxlT3JkZXJDYWxsYmFja0FycmF5W2F0dHJpZF0sXHJcbiAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXHJcbiAgICAgICAgICAgIGRhdGE6ICAgICB7IFwib3JkZXJWYWx1ZXNcIjogb3JkZXJEYXRhIH0sXHJcbiAgICAgICAgICAgIHR5cGU6ICAgICAnUE9TVCcsXHJcbiAgICAgICAgICAgIHRyYWRpdGlvbmFsOiB0cnVlLCBcclxuICAgICAgICB9KS5kb25lKGZ1bmN0aW9uIChyZXMpIFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgdmFyIHZhbHVlID0gcGFyc2VJbnQob3JkZXJWYWx1ZSkgKiAtMTtcclxuICAgICAgICAgICAgY3VyT2JqZWN0LmF0dHIoXCJkYXRhLW9yZGVyXCIsIHZhbHVlKTtcclxuXHJcbiAgICAgICAgICAgIGN1ck9iamVjdC5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKFwic29ydEFzY1wiKTtcclxuICAgICAgICAgICAgY3VyT2JqZWN0LnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoXCJzb3J0RGVzY1wiKTtcclxuICAgICAgICAgICAgY3VyT2JqZWN0LnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XHJcblxyXG4gICAgICAgICAgICBjdXJPYmplY3QucmVtb3ZlQ2xhc3MoXCJzb3J0QXNjXCIpO1xyXG4gICAgICAgICAgICBjdXJPYmplY3QucmVtb3ZlQ2xhc3MoXCJzb3J0RGVzY1wiKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PSAxKVxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBjdXJPYmplY3QuYWRkQ2xhc3MoXCJzb3J0QXNjXCIpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY3VyT2JqZWN0LmFkZENsYXNzKFwic29ydERlc2NcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY3VyT2JqZWN0LmFkZENsYXNzKFwiYWN0aXZlXCIpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbGRmVGFibGVDdXJQYWdlQXR0cmlidXRlW2F0dHJpZF0gPSBcIjFcIjtcclxuICAgICAgICAgICAgTERGVGFibGVSZW5kZXJCb2R5KHJlcywgYXR0cmlkKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9XHJcbn1cclxuXHJcbiQoXCIuaW50ZXJuYWxGb290ZXJcIikub24oXCJjbGlja1wiLCBcImxpID4gYVwiLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG59KTtcclxuXHJcblxyXG5pZiAodHlwZW9mKGxkZlRhYmxlUm93c0FycmF5KSA9PSAndW5kZWZpbmVkJykgeyAgdmFyIGxkZlRhYmxlUm93c0FycmF5ID0gbmV3IEFycmF5KCk7IH1cclxuXHJcbmZ1bmN0aW9uIExERlRhYmxlUmVuZGVyQm9keShkYXRhLCBhdHRyaWQpIHtcclxuICAgIHZhciBwYWdlQ291bnQgICAgPSBkYXRhLnBhZ2VDb3VudDtcclxuICAgIHZhciByb3dDb3VudCAgICAgPSBkYXRhLnJvd0NvdW50O1xyXG4gICAgZGF0YSAgICAgICAgICAgICA9IGRhdGEubGlzdF9yb3dzO1xyXG5cclxuICAgIGxkZlRhYmxlVEJvZHlBcnJheVthdHRyaWRdLmVtcHR5KCk7XHJcbiAgICBsZGZUYWJsZVJvd3NBcnJheVthdHRyaWRdID0gZGF0YTtcclxuXHJcbiAgICBpZiAoJChkYXRhKS5sZW5ndGggPT0gMClcclxuICAgIHtcclxuICAgICAgICByb3cgPSBcIjx0cj48dGQgY29sc3Bhbj0nXCIgKyAkKGxkZlRhYmxlSGVhZGVyQXJyYXlbYXR0cmlkXSkubGVuZ3RoICsgXCInIHN0eWxlPSd0ZXh0LWFsaWduOmNlbnRlcjsnPlNlbSByZWdpc3RvczwvdGQ+PC90cj5cIjtcclxuICAgICAgICBsZGZUYWJsZVRCb2R5QXJyYXlbYXR0cmlkXS5hcHBlbmQocm93KTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgJC5lYWNoKGRhdGEsIGZ1bmN0aW9uIChkYXRha2V5LCBkYXRhVmFsdWUpIHtcclxuICAgICAgICB2YXIgcm93ID0gXCI8dHIgZGF0YS1yb3dpZD0nXCIgKyBkYXRhVmFsdWUucm93SUQgKyBcIic+XCI7XHJcblxyXG4gICAgICAgICQuZWFjaChkYXRhVmFsdWUucm93SXRlbXMsIGZ1bmN0aW9uIChyb3dLZXksIHJvd1ZhbHVlKSB7XHJcblxyXG4gICAgICAgICAgICAkLmVhY2gobGRmVGFibGVIZWFkZXJBcnJheVthdHRyaWRdLCBmdW5jdGlvbiAoaGVhZGVyS2V5LCBoZWFkZXJWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJvd1ZhbHVlLml0ZW1Db2x1bW5OYW1lID09IGhlYWRlclZhbHVlW1wiaGVhZGVySURcIl0gJiYgaGVhZGVyVmFsdWVbXCJoZWFkZXJWaXNpYmxlXCJdICE9IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gcm93VmFsdWUuaXRlbVZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL2lmIChoZWFkZXJWYWx1ZVtcImhlYWRlclR5cGVcIl0gIT0gbnVsbCAmJiBoZWFkZXJWYWx1ZVtcImhlYWRlclR5cGVcIl0uaW5kZXhPZihcIlN5c3RlbS5EYXRlVGltZVwiKSAhPSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIC8vICB2YWx1ZSA9IFRvSmF2YVNjcmlwdERhdGUodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL30gXHJcbiAgICAgICAgICAgICAgICAgICAgLy99IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyb3dWYWx1ZS5pdGVtTGluayAhPSBudWxsICYmIHJvd1ZhbHVlLml0ZW1MaW5rICE9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gXCI8YSBocmVmPVxcXCJcIiArIHJvd1ZhbHVlLml0ZW1MaW5rICsgXCJcXFwiPlwiICsgdmFsdWUgKyBcIjwvYT5cIjtcclxuICAgICAgICAgICAgICAgICAgICB9IFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhdHRyTW9iaWxlID0gXCJGYWxzZVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChoZWFkZXJWYWx1ZVtcImhlYWRlck1vYmlsZVwiXSA9PSBmYWxzZSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJNb2JpbGUgPSBcIkZhbHNlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXR0ck1vYmlsZSA9IFwiVHJ1ZVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN0eWxlID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBjIGluIGhlYWRlclZhbHVlW1wiaGVhZGVyU3R5bGVcIl0pXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGVhZGVyVmFsdWVbXCJoZWFkZXJTdHlsZVwiXS5oYXNPd25Qcm9wZXJ0eShjKSkgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlICs9IGMgKyBcIjpcIiArIGhlYWRlclZhbHVlW1wiaGVhZGVyU3R5bGVcIl1bY10gKyBcIjtcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJvdyArPSBcIjx0ZCBkYXRhLXNob3dNb2JpbGU9J1wiICsgYXR0ck1vYmlsZSArIFwiJyBkYXRhLWNvbHVtbj0nXCIgKyByb3dWYWx1ZS5pdGVtQ29sdW1uTmFtZSArIFwiJyBkYXRhLWVkaXRhYmxlPSdcIiArIGhlYWRlclZhbHVlW1wiaGVhZGVyRWRpdGFibGVcIl0gKyBcIicgc3R5bGU9J1wiICsgc3R5bGUgKyBcIic+XCIgKyB2YWx1ZSArIFwiPC90ZD5cIjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgXHJcblxyXG4gICAgICAgIH0pO1xyXG4gICAgIFxyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChsZGZUYWJsZUF0dHJpYnV0ZXNbYXR0cmlkXS5jYW5FZGl0Um93ID09IHRydWUpXHJcbiAgICAgICAgICAgIHJvdyArPSBcIjx0ZD48aW5wdXQgdHlwZT0nYnV0dG9uJyBjbGFzcz0nbGRmVGFibGVFZGl0Um93X1wiICsgYXR0cmlkICsgXCInIHZhbHVlPSdFZGl0YXInLz48L3RkPlwiO1xyXG5cclxuICAgICAgICBpZiAobGRmVGFibGVBdHRyaWJ1dGVzW2F0dHJpZF0uY2FuRGVsZXRlUm93ID09IHRydWUpXHJcbiAgICAgICAgICAgIHJvdyArPSBcIjx0ZD48aW5wdXQgdHlwZT0nYnV0dG9uJyBjbGFzcz0nbGRmVGFibGVSZW1vdmVSb3dfXCIgKyBhdHRyaWQgKyBcIicgdmFsdWU9J1JlbW92ZXInLz48L3RkPlwiO1xyXG5cclxuICAgICAgICByb3cgKz0gXCI8L3RyPlwiO1xyXG5cclxuICAgICAgICBsZGZUYWJsZVRCb2R5QXJyYXlbYXR0cmlkXS5hcHBlbmQocm93KTtcclxuICAgIH0pO1xyXG5cclxuICAgIEluaXRSb3dJbmxpbmVCdXR0b25zKGF0dHJpZCk7XHJcbiAgICBMREZUYWJsZVJlbmRlclBhZ2VzKHBhZ2VDb3VudCwgcm93Q291bnQsIGF0dHJpZCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIExERlRhYmxlUmVuZGVyUGFnZXMocGFnZUNvdW50LCByb3dDb3VudCwgYXR0cmlkKSB7XHJcbiAgICB2YXIgaSA9IDA7XHJcbiAgICB2YXIgYWN0aXZlUGFnZSA9IFwiXCI7XHJcbiAgICB2YXIgbkhpZGVQYWdlcyA9IDA7XHJcbiAgICBsZGZUYWJsZURpdkZvb3RlckFycmF5W2F0dHJpZF0uZW1wdHkoKTtcclxuXHJcbiAgICBmb3IgKGkgPSAwOyBpIDw9IHBhZ2VDb3VudDsgaSsrKSB7XHJcblxyXG4gICAgICAgIGlmICgoaSsxKSA9PSBsZGZUYWJsZUN1clBhZ2VBdHRyaWJ1dGVbYXR0cmlkXSlcclxuICAgICAgICAgICAgYWN0aXZlUGFnZSA9IFwiYWN0aXZlXCI7XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICBhY3RpdmVQYWdlID0gXCJcIjtcclxuXHJcbiAgICAgICAgaGlkZVBhZ2UgPSBcIlwiO1xyXG5cclxuICAgICAgICBpZiAoKGkrMSk+NSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGlmIChpIDw9IHBhZ2VDb3VudCkge1xyXG4gICAgICAgICAgICAgICAgaGlkZVBhZ2UgPSBcImhpZGRlblwiO1xyXG4gICAgICAgICAgICAgICAgbkhpZGVQYWdlcyArPSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiAoKGkrMSkgPD0gbGRmVGFibGVDdXJQYWdlQXR0cmlidXRlW2F0dHJpZF0pIHtcclxuICAgICAgICAgICAgICAgIGlmIChoaWRlUGFnZSAhPSBcIlwiKVxyXG4gICAgICAgICAgICAgICAgICAgIG5IaWRlUGFnZXMgLT0gMTtcclxuXHJcbiAgICAgICAgICAgICAgICBoaWRlUGFnZSA9IFwiXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGl0ZW1QYWdlID0gXCI8bGkgY2xhc3M9J1wiICsgYWN0aXZlUGFnZSArIFwiIFwiICsgaGlkZVBhZ2UgKyBcIic+PGEgaHJlZj0nIycgZGF0YS1wYWdlPSdcIiArIChpICsgMSkgKyBcIicgZGF0YS1vcmRlcj0nMSc+XCIgKyAoaSArIDEpICsgXCI8L2E+PC9saT5cIjtcclxuICAgICAgICBsZGZUYWJsZURpdkZvb3RlckFycmF5W2F0dHJpZF0uYXBwZW5kKGl0ZW1QYWdlKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG5IaWRlUGFnZXMgPiAwKVxyXG4gICAge1xyXG4gICAgICAgIGl0ZW1QYWdlID0gXCI8bGk+PGEgaHJlZj0nIycgZGF0YS1wYWdlPScwJz4uLi48L2E+PC9saT5cIjtcclxuICAgICAgICBsZGZUYWJsZURpdkZvb3RlckFycmF5W2F0dHJpZF0uYXBwZW5kKGl0ZW1QYWdlKTsgICAgXHJcbiAgICB9XHJcblxyXG4gICAgbGRmVGFibGVEaXZGb290ZXJBcnJheVthdHRyaWRdLnBhcmVudCgpLmZpbmQoXCIucm93XCIpLnJlbW92ZSgpO1xyXG4gICAgaXRlbVBhZ2UgPSBcIjxkaXYgY2xhc3M9J3Jvdycgc3R5bGU9J3Bvc2l0aW9uOiByZWxhdGl2ZTt3aWR0aDogMTAwJTttYXJnaW4tdG9wOiAtMTBweDsnPjxzcGFuIGNsYXNzPSdyb3dDb3VudCc+VG90YWw6IFwiICsgcm93Q291bnQgKyBcIiBSZWdpc3Rvczwvc3Bhbj48L2Rpdj5cIjtcclxuICAgIGxkZlRhYmxlRGl2Rm9vdGVyQXJyYXlbYXR0cmlkXS5wYXJlbnQoKS5hcHBlbmQoaXRlbVBhZ2UpO1xyXG5cclxuXHJcbn1cclxuXHJcblxyXG5cclxuXHJcbmZ1bmN0aW9uIExERlRhYmxlQ2hhbmdlUGFnZShwYWdlLCBhdHRyaWQpIHtcclxuICAgIHZhciBvcmRlckRhdGEgPSBbXTtcclxuXHJcbiAgICBpZiAocGFnZSA9PSAwKSB7XHJcblxyXG4gICAgICAgIHZhciBvYmpJRCAgID0gJChsZGZUYWJsZURpdkZvb3RlckFycmF5W2F0dHJpZF0pWzBdLmlkO1xyXG4gICAgICAgIHZhciBpZHggICAgID0gMDtcclxuICAgICAgICAkKFwiI1wiICsgb2JqSUQgKyBcIiBsaS5oaWRkZW5cIikuZWFjaChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKGlkeCA8PSAxMCkge1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWR4ICsrO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpZiAoJChcIiNcIiArIG9iaklEICsgXCIgbGkuaGlkZGVuXCIpLmxlbmd0aCA9PSAwKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgJChcIiNcIiArIG9iaklEICsgXCIgbGlcIikuZmluZChcIltkYXRhLXBhZ2U9JzAnXVwiKS5yZW1vdmUoKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdmFyIGVsZW0gPSBsZGZUYWJsZVRIZWFkZXJBcnJheVthdHRyaWRdLmZpbmQoXCJ0aC5hY3RpdmVcIik7XHJcbiAgICAgICAgb3JkZXJEYXRhWzBdID0gZWxlbS5hdHRyKFwiZGF0YS1maWVsZFwiKTtcclxuICAgICAgICBvcmRlckRhdGFbMV0gPSBlbGVtLmF0dHIoXCJkYXRhLW9yZGVyXCIpO1xyXG5cclxuICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICB1cmw6IGxkZlRhYmxlUGFnZUNhbGxiYWNrQXJyYXlbYXR0cmlkXSxcclxuICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcclxuICAgICAgICAgICAgZGF0YTogeyAncGFnZU51bWJlcic6IHBhZ2UsICdvcmRlckRhdGEnOiBvcmRlckRhdGEgfSxcclxuICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxyXG4gICAgICAgICAgICB0cmFkaXRpb25hbDogdHJ1ZVxyXG4gICAgICAgIH0pLmRvbmUoZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAgICAgICBsZGZUYWJsZUN1clBhZ2VBdHRyaWJ1dGVbYXR0cmlkXSA9IHBhZ2U7XHJcbiAgICAgICAgICAgIExERlRhYmxlUmVuZGVyQm9keShyZXMsIGF0dHJpZCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG5cclxuZnVuY3Rpb24gVG9KYXZhU2NyaXB0RGF0ZSh2YWx1ZSkge1xyXG4gICAgdmFyIHBhdHRlcm47XHJcbiAgICB2YXIgcmVzdWx0cztcclxuICAgIHZhciBkdDtcclxuICAgIHZhciByZXM7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIHBhdHRlcm4gPSAvRGF0ZVxcKChbXildKylcXCkvO1xyXG4gICAgICAgIHJlc3VsdHMgPSBwYXR0ZXJuLmV4ZWModmFsdWUpO1xyXG4gICAgICAgIGR0ID0gbmV3IERhdGUocGFyc2VGbG9hdChyZXN1bHRzWzFdKSk7XHJcbiAgICAgICAgcmVzID0gKGR0LmdldE1vbnRoKCkgKyAxKSArIFwiL1wiICsgZHQuZ2V0RGF0ZSgpICsgXCIvXCIgKyBkdC5nZXRGdWxsWWVhcigpO1xyXG4gICAgfVxyXG4gICAgY2F0Y2goZXJyKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJsZGZUYWJsZSB8IFRvSmF2YVNjcmlwdERhdGVcIiArIGVyci5tZXNzYWdlKTtcclxuICAgICAgICByZXMgPSBcIlwiO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlcztcclxufVxyXG5cclxuXHJcbmZ1bmN0aW9uIExERlRhYmxlUmVzZXRDb3VudGVyKGF0dHJpZClcclxue1xyXG4gICAgY2xlYXJJbnRlcnZhbChsZGZUYWJsZVJlZnJlc2hUaW1lT2JqZWN0W2F0dHJpZF0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBMREZUYWJsZVJlc3RhcnRDb3VudGVyKGF0dHJpZClcclxue1xyXG4gICAgdmFyIHRpbWVvdXRDb3VudCA9IGxkZlRhYmxlUmVmcmVzaFRpbWVbYXR0cmlkXTtcclxuICAgIGxkZlRhYmxlUmVmcmVzaFRpbWVPYmplY3RbYXR0cmlkXSA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsgVXBkYXRlUmVmcmVzaEhlYWRlcihhdHRyaWQsIHRpbWVvdXRDb3VudCk7IHdpbmRvd1tsZGZUYWJsZVJlZnJlc2hDYWxsQmFja0FycmF5W2F0dHJpZF1dKCk7IH0sIHRpbWVvdXRDb3VudCk7XHJcbn1cclxuXHJcblxyXG5mdW5jdGlvbiBVcGRhdGVSZWZyZXNoSGVhZGVyKGF0dHJpZCwgdGltZSlcclxue1xyXG4gICAgdmFyIGR0VGltZSA9IG5ldyBEYXRlKCk7XHJcbiAgICBkdFRpbWUuc2V0U2Vjb25kcyhkdFRpbWUuZ2V0U2Vjb25kcygpICsgKHRpbWUvMTAwMCkpO1xyXG4gICAgdmFyIGhyID0gKGR0VGltZS5nZXRIb3VycygpIDw9IDkgPyBcIjBcIiA6IFwiXCIpICsgZHRUaW1lLmdldEhvdXJzKCk7XHJcbiAgICB2YXIgbW4gPSAoZHRUaW1lLmdldE1pbnV0ZXMoKSA8PSA5ID8gXCIwXCIgOiBcIlwiKSArIGR0VGltZS5nZXRNaW51dGVzKCk7XHJcbiAgICB2YXIgc2MgPSAoZHRUaW1lLmdldFNlY29uZHMoKSA8PSA5ID8gXCIwXCIgOiBcIlwiKSArIGR0VGltZS5nZXRTZWNvbmRzKCk7XHJcblxyXG5cclxuICAgICQoXCIjYXV0b1JlZnJlc2hcIiArIGF0dHJpZCkuY2hpbGRyZW4oJ3NwYW4nKS5odG1sKFwiUHLDs3hpbWEgYXR1YWxpemHDp8OjbyBcIiArIGhyICsgXCI6XCIgKyBtbiArIFwiOlwiICsgc2MpO1xyXG59XHJcblxyXG5cclxuZnVuY3Rpb24gSW5pdFJvd0lubGluZUJ1dHRvbnMoYXR0cmlkKVxyXG57XHJcbiAgICAkKFwiLmxkZlRhYmxlRWRpdFJvd19cIiArIGF0dHJpZCkub24oXCJjbGlja1wiLCBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgY3VyT2JqZWN0ICAgPSAkKHRoaXMpO1xyXG4gICAgICAgIHZhciBwYXJlbnRUUiAgICA9ICQodGhpcykuY2xvc2VzdChcInRyXCIpO1xyXG5cclxuICAgICAgICBpZiAoJChwYXJlbnRUUikuYXR0cihcImRhdGEtZWRpdGluZ1wiKSA9PSBcInRydWVcIilcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIFNhdmVSb3coYXR0cmlkLCBjdXJPYmplY3QsIHBhcmVudFRSKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBFZGl0Um93KGF0dHJpZCwgY3VyT2JqZWN0LCBwYXJlbnRUUik7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgJChcIi5sZGZUYWJsZVJlbW92ZVJvd19cIiArIGF0dHJpZCkub24oXCJjbGlja1wiLCBmdW5jdGlvbigpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIlJlbW92ZSBSb3cgSW4gRGV2ZWxvcG1lbnRcIik7XHJcbiAgICB9KTsgICAgXHJcbn1cclxuXHJcblxyXG5mdW5jdGlvbiBFZGl0Um93KGF0dHJpZCwgY3VyT2JqZWN0LCBwYXJlbnRUUilcclxue1xyXG4gICAgJChwYXJlbnRUUikuYXR0cihcImRhdGEtZWRpdGluZ1wiLCBcInRydWVcIik7XHJcbiAgICBjdXJPYmplY3QudmFsKFwiR3JhdmFyXCIpO1xyXG5cclxuICAgICQoY3VyT2JqZWN0KS5wYXJlbnQoKS5hcHBlbmQoXCI8aW5wdXQgdHlwZT0nYnV0dG9uJyBjbGFzcz0nbGRmVGFibGVDYW5jZWxFZGl0Um93X1wiICsgYXR0cmlkICsgXCInIHZhbHVlPSdDYW5jZWxhcicvPlwiKTtcclxuICAgIEluaXRSb3dJbmxpbmVDYW5jZWxCdXR0b24oYXR0cmlkKTtcclxuICAgIHZhciByb3dJRCAgICAgICA9IHBhcmVudFRSLmF0dHIoXCJkYXRhLXJvd2lkXCIpO1xyXG5cclxuICAgICQuZWFjaChsZGZUYWJsZUhlYWRlckFycmF5W2F0dHJpZF0sIGZ1bmN0aW9uIChkYXRha2V5LCBkYXRhVmFsdWUpIHtcclxuICAgICAgICBpZiAoZGF0YVZhbHVlLmhlYWRlckVkaXRhYmxlID09IHRydWUpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAkLmVhY2goJChwYXJlbnRUUikuY2hpbGRyZW4oXCJ0ZFwiKSwgZnVuY3Rpb24gKHRka2V5LCB0ZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoJCh0ZFZhbHVlKS5hdHRyKFwiZGF0YS1jb2x1bW5cIikgPT0gZGF0YVZhbHVlLmhlYWRlcklEIClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAkKHRkVmFsdWUpLmF0dHIoXCJkYXRhLWN1clZhbHVlXCIsICQodGRWYWx1ZSkuaHRtbCgpKTtcclxuICAgICAgICAgICAgICAgICAgICAvL2lmIChoZWFkZXJWYWx1ZVtcImhlYWRlclR5cGVcIl0gIT0gbnVsbCAmJiBoZWFkZXJWYWx1ZVtcImhlYWRlclR5cGVcIl0uaW5kZXhPZihcIlN5c3RlbS5EYXRlVGltZVwiKSAhPSAtMSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmh0bWwoUmVuZGVyRWRpdG9yRmllbGQoZGF0YVZhbHVlLCAkKHRkVmFsdWUpLmh0bWwoKSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICQoJy5sZGZlZGl0YWJsZS5taW5pbWFsJykuaUNoZWNrKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tib3hDbGFzczogJ2ljaGVja2JveF9mbGF0LWdyZWVuJ1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vWydkYXRhLWNvbHVtbic9J1wiICsgZGF0YVZhbHVlLmhlYWRlcklEICsgXCInXVwiKVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBTYXZlUm93KGF0dHJpZCwgY3VyT2JqZWN0LCBwYXJlbnRUUilcclxue1xyXG4gICAgdmFyIGpzb25PYmplY3QgPSBuZXcgT2JqZWN0KCk7XHJcblxyXG4gICAgJC5lYWNoKCQocGFyZW50VFIpLmNoaWxkcmVuKFwidGRbZGF0YS1lZGl0YWJsZT0ndHJ1ZSddXCIpLCBmdW5jdGlvbiAodGRrZXksIHRkVmFsdWUpIHtcclxuICAgICAgICAkLmVhY2gobGRmVGFibGVIZWFkZXJBcnJheVthdHRyaWRdLCBmdW5jdGlvbiAoZGF0YWtleSwgZGF0YVZhbHVlKSB7XHJcbiAgICAgICAgICAgIGlmIChkYXRhVmFsdWUuaGVhZGVySUQgPT0gJCh0ZFZhbHVlKS5hdHRyKFwiZGF0YS1jb2x1bW5cIikpXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGpzb25PYmplY3RbZGF0YVZhbHVlLmhlYWRlcklEXSA9IEdldEVkaXRvckZpZWxkVmFsdWUoZGF0YVZhbHVlLCB0ZFZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgJC5hamF4KHtcclxuICAgICAgICB1cmw6IGxkZlRhYmxlRWRpdENhbGxCYWNrQXJyYXlbYXR0cmlkXSxcclxuICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxyXG4gICAgICAgIGRhdGE6IHsgJ3Jvd0lEJzogcGFyZW50VFIuYXR0cihcImRhdGEtcm93aWRcIiksICdmaWVsZHMnOiBKU09OLnN0cmluZ2lmeShqc29uT2JqZWN0KSB9LFxyXG4gICAgICAgIHR5cGU6ICdQT1NUJyxcclxuICAgICAgICB0cmFkaXRpb25hbDogdHJ1ZVxyXG4gICAgfSkuZG9uZShmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgcGFyZW50VFIuYXR0cihcImRhdGEtZWRpdGluZ1wiLCBcImZhbHNlXCIpO1xyXG4gICAgICAgICQocGFyZW50VFIpLmZpbmQoXCJpbnB1dC5sZGZUYWJsZUNhbmNlbEVkaXRSb3dfXCIgKyBhdHRyaWQpLnJlbW92ZSgpOyAgICBcclxuICAgICAgICAkKGN1ck9iamVjdCkudmFsKFwiRWRpdGFyXCIpO1xyXG5cclxuICAgICAgICAkLmVhY2goJChwYXJlbnRUUikuY2hpbGRyZW4oXCJ0ZFtkYXRhLWVkaXRhYmxlPSd0cnVlJ11cIiksIGZ1bmN0aW9uICh0ZGtleSwgdGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAkLmVhY2gobGRmVGFibGVIZWFkZXJBcnJheVthdHRyaWRdLCBmdW5jdGlvbiAoZGF0YWtleSwgZGF0YVZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YVZhbHVlLmhlYWRlcklEID09ICQodGRWYWx1ZSkuYXR0cihcImRhdGEtY29sdW1uXCIpKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICQodGRWYWx1ZSkuaHRtbChqc29uT2JqZWN0W2RhdGFWYWx1ZS5oZWFkZXJJRF0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTsgICAgICAgICAgICBcclxuICAgIH0pOyAgICAgXHJcbn1cclxuXHJcbmZ1bmN0aW9uIEluaXRSb3dJbmxpbmVDYW5jZWxCdXR0b24oYXR0cmlkKVxyXG57XHJcbiAgICAkKFwiLmxkZlRhYmxlQ2FuY2VsRWRpdFJvd19cIiArIGF0dHJpZCkub24oXCJjbGlja1wiLCBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgY3VyT2JqZWN0ICAgPSAkKHRoaXMpO1xyXG4gICAgICAgIHZhciBwYXJlbnRUUiAgICA9ICQodGhpcykuY2xvc2VzdChcInRyXCIpO1xyXG4gICAgICAgICQuZWFjaCgkKHBhcmVudFRSKS5jaGlsZHJlbihcInRkW2RhdGEtZWRpdGFibGU9J3RydWUnXVwiKSwgZnVuY3Rpb24gKHRka2V5LCB0ZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICQodGRWYWx1ZSkuaHRtbCgkKHRkVmFsdWUpLmF0dHIoXCJkYXRhLWN1clZhbHVlXCIpKTtcclxuICAgICAgICAgICAgJCh0ZFZhbHVlKS5hdHRyKFwiZGF0YS1jdXJWYWx1ZVwiLCBcIlwiKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY3VyT2JqZWN0LnJlbW92ZSgpO1xyXG4gICAgICAgIHZhciBlZGl0T2JqID0gJChwYXJlbnRUUikuZmluZChcImlucHV0LmxkZlRhYmxlRWRpdFJvd19cIiArIGF0dHJpZCk7XHJcbiAgICAgICAgZWRpdE9iai52YWwoXCJFZGl0YXJcIik7XHJcbiAgICAgICAgcGFyZW50VFIuYXR0cihcImRhdGEtZWRpdGluZ1wiLCBcImZhbHNlXCIpO1xyXG4gICAgfSk7ICAgICAgICBcclxufVxyXG5cclxuXHJcblxyXG5mdW5jdGlvbiBSZW5kZXJFZGl0b3JGaWVsZChjb2xPYmplY3QsIHZhbHVlKVxyXG57XHJcbiAgICBpZiAoY29sT2JqZWN0LmhlYWRlclR5cGUuaW5kZXhPZihcIlN0cmluZ1wiKSAhPSAtMSkge1xyXG4gICAgICAgIHJldHVybiBcIjxpbnB1dCB0eXBlPSd0ZXh0JyBjbGFzcz0nZm9ybS1jb250cm9sJyB2YWx1ZT0nXCIgKyB2YWx1ZSArIFwiJyAvPlwiO1xyXG4gICAgfSBlbHNlIGlmIChjb2xPYmplY3QuaGVhZGVyVHlwZS5pbmRleE9mKFwiRGF0ZVRpbWVcIikgIT0gLTEpIHtcclxuICAgICAgICByZXR1cm4gXCI8aW5wdXQgdHlwZT0ndGV4dCcgY2xhc3M9J2Zvcm0tY29udHJvbCcgdmFsdWU9J1wiICsgdmFsdWUgKyBcIicgLz5cIjtcclxuICAgIH0gZWxzZSBpZiAoY29sT2JqZWN0LmhlYWRlclR5cGUuaW5kZXhPZihcIlNlbGVjdExpc3RcIikgIT0gLTEgfHwgY29sT2JqZWN0LmhlYWRlclR5cGUuaW5kZXhPZihcIkJvb2xlYW5cIikgIT0gLTEpIHtcclxuICAgICAgICB2YXIgaXRlbSA9IFwiXCI7XHJcblxyXG4gICAgICAgIGZvciAodmFyIGMgaW4gY29sT2JqZWN0LmhlYWRlckVkaXRDb250ZW50KVxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaWYgKGNvbE9iamVjdC5oZWFkZXJFZGl0Q29udGVudC5oYXNPd25Qcm9wZXJ0eShjKSkgXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHZhciBzZWxlY3RlZCA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gY29sT2JqZWN0LmhlYWRlckVkaXRDb250ZW50W2NdKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkID0gXCJzZWxlY3RlZFwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaXRlbSArPSBcIjxvcHRpb24gdmFsdT0nXCIgKyBjICsgXCInIFwiICsgIHNlbGVjdGVkICsgXCI+XCIgKyBjb2xPYmplY3QuaGVhZGVyRWRpdENvbnRlbnRbY10gKyBcIjwvb3B0aW9uPlwiO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gXCI8c2VsZWN0IGNsYXNzPSdmb3JtLWNvbnRyb2wnPlwiICsgaXRlbSArIFwiPC9zZWxlY3Q+XCI7XHJcbiAgICB9IFxyXG59XHJcblxyXG5mdW5jdGlvbiBHZXRFZGl0b3JGaWVsZFZhbHVlKGNvbE9iamVjdCwgZWRpdE9iamVjdClcclxue1xyXG4gICAgaWYgKGNvbE9iamVjdC5oZWFkZXJUeXBlLmluZGV4T2YoXCJTdHJpbmdcIikgIT0gLTEpIHtcclxuICAgICAgICByZXR1cm4gJChlZGl0T2JqZWN0KS5jaGlsZHJlbigpLnZhbCgpO1xyXG4gICAgfSBlbHNlIGlmIChjb2xPYmplY3QuaGVhZGVyVHlwZS5pbmRleE9mKFwiRGF0ZVRpbWVcIikgIT0gLTEpIHtcclxuICAgICAgICByZXR1cm4gJChlZGl0T2JqZWN0KS5jaGlsZHJlbigpLnZhbCgpO1xyXG4gICAgfSBlbHNlIGlmIChjb2xPYmplY3QuaGVhZGVyVHlwZS5pbmRleE9mKFwiU2VsZWN0TGlzdFwiKSAhPSAtMSkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCQoJChlZGl0T2JqZWN0KS5jaGlsZHJlbigpKS5pbm5lckhUTUwpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCQoJChlZGl0T2JqZWN0KS5jaGlsZHJlbigpKS5zZWxlY3RlZE9wdGlvbnMpO1xyXG5cclxuXHJcbiAgICAgICAgcmV0dXJuICQoZWRpdE9iamVjdCkuY2hpbGRyZW4oKS52YWwoKTtcclxuICAgIH0gZWxzZSBpZiAoY29sT2JqZWN0LmhlYWRlclR5cGUuaW5kZXhPZihcIkJvb2xlYW5cIikgIT0gLTEpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygkKCQoZWRpdE9iamVjdCkuY2hpbGRyZW4oKSkuaW5uZXJIVE1MKTtcclxuICAgICAgICBjb25zb2xlLmxvZygkKCQoZWRpdE9iamVjdCkuY2hpbGRyZW4oKSkuc2VsZWN0ZWRPcHRpb25zKTtcclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gJChlZGl0T2JqZWN0KS5jaGlsZHJlbigpLnZhbCgpO1xyXG4gICAgfVxyXG5cclxufSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==